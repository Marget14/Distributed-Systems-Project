<!DOCTYPE html>
<html
        xmlns:th="https://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{base}">
<div class="max-w-4xl mx-auto px-4 py-8">
    <!-- Order Header -->
    <div class="modern-card p-8 mb-8 text-center">
        <div class="w-20 h-20 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center mx-auto mb-6">
            <i class="fas fa-check text-3xl text-white"></i>
        </div>
        <h1 class="text-3xl font-display font-bold mb-2">Order Confirmed!</h1>
        <p class="text-gray-600 mb-4">Your order has been received and is being prepared</p>
        <div class="inline-flex items-center gap-2 bg-primary/10 text-primary px-4 py-2 rounded-lg">
            <i class="fas fa-receipt"></i>
            <span class="font-mono font-bold" id="order-id">ORD-98234761</span>
        </div>
    </div>

    <!-- Order Progress -->
    <div class="modern-card p-8 mb-8">
        <h2 class="text-xl font-display font-bold mb-6">Order Progress</h2>

        <div class="order-progress mb-8">
            <div class="progress-step completed">
                <div class="progress-dot">
                    <i class="fas fa-check"></i>
                </div>
                <span class="text-sm font-medium mt-2">Order Placed</span>
                <span class="text-xs text-gray-500 mt-1" id="time-placed">12:05 PM</span>
            </div>
            <div class="progress-step active">
                <div class="progress-dot">2</div>
                <span class="text-sm font-medium mt-2">Preparing</span>
                <span class="text-xs text-gray-500 mt-1" id="time-preparing">12:10 PM</span>
            </div>
            <div class="progress-step">
                <div class="progress-dot">3</div>
                <span class="text-sm font-medium mt-2">On the Way</span>
                <span class="text-xs text-gray-500 mt-1" id="time-ontheway">Estimated 12:35 PM</span>
            </div>
            <div class="progress-step">
                <div class="progress-dot">4</div>
                <span class="text-sm font-medium mt-2">Delivered</span>
                <span class="text-xs text-gray-500 mt-1" id="time-delivered">Estimated 12:45 PM</span>
            </div>
        </div>

        <!-- Estimated Delivery -->
        <div class="bg-gradient-to-r from-primary/10 to-secondary/10 rounded-xl p-6">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="font-display font-bold mb-1">Estimated Delivery Time</h3>
                    <p class="text-gray-600">Your order will arrive in approximately</p>
                </div>
                <div class="text-right">
                    <div class="text-3xl font-display font-bold text-primary" id="countdown">25:00</div>
                    <p class="text-sm text-gray-600">minutes</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Details -->
    <div class="grid md:grid-cols-2 gap-8 mb-8">
        <!-- Order Summary -->
        <div class="modern-card p-6">
            <h3 class="text-lg font-display font-bold mb-4">Order Summary</h3>
            <div class="space-y-4 mb-6" id="tracking-items">
                <!-- Items will be loaded here -->
            </div>

            <div class="border-t pt-4">
                <div class="space-y-2">
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Subtotal</span>
                        <span id="tracking-subtotal">€23.97</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Delivery Fee</span>
                        <span>€2.50</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="text-gray-600">Service Fee</span>
                        <span>€0.50</span>
                    </div>
                    <div class="flex justify-between font-bold text-lg pt-2 border-t">
                        <span>Total</span>
                        <span id="tracking-total">€26.97</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delivery Information -->
        <div class="modern-card p-6">
            <h3 class="text-lg font-display font-bold mb-4">Delivery Information</h3>
            <div class="space-y-6">
                <!-- Restaurant Info -->
                <div>
                    <h4 class="font-bold mb-2">Restaurant</h4>
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-lg overflow-hidden">
                            <img src="https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=200"
                                 alt="Burger Palace"
                                 class="w-full h-full object-cover">
                        </div>
                        <div>
                            <div class="font-bold">Burger Palace</div>
                            <div class="text-sm text-gray-600">25-35 min delivery</div>
                        </div>
                    </div>
                </div>

                <!-- Delivery Address -->
                <div>
                    <h4 class="font-bold mb-2">Delivery Address</h4>
                    <div class="flex items-start gap-3">
                        <i class="fas fa-map-marker-alt text-primary mt-1"></i>
                        <div>
                            <div>Patission 76, Athens 10434</div>
                            <div class="text-sm text-gray-600">Apartment 3, 2nd floor</div>
                        </div>
                    </div>
                </div>

                <!-- Driver Info -->
                <div>
                    <h4 class="font-bold mb-2">Your Driver</h4>
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div>
                            <div class="font-bold" id="driver-name">Alex Papadopoulos</div>
                            <div class="text-sm text-gray-600">Arriving in 25 minutes</div>
                        </div>
                    </div>
                </div>

                <!-- Contact Buttons -->
                <div class="flex gap-3 pt-4">
                    <button onclick="callRestaurant()" class="modern-btn-outline flex-1">
                        <i class="fas fa-phone mr-2"></i>Call Restaurant
                    </button>
                    <button onclick="callDriver()" class="modern-btn-outline flex-1">
                        <i class="fas fa-phone mr-2"></i>Call Driver
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Live Tracking -->
    <div class="modern-card p-6 mb-8">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-display font-bold">Live Tracking</h3>
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 rounded-full bg-success animate-pulse"></div>
                <span class="text-sm text-success font-medium">LIVE</span>
            </div>
        </div>

        <div class="relative h-64 rounded-xl overflow-hidden bg-gradient-to-b from-gray-100 to-gray-200">
            <!-- Map placeholder -->
            <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-center">
                    <i class="fas fa-map-marked-alt text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600">Live map tracking would appear here</p>
                </div>
            </div>

            <!-- Driver marker -->
            <div class="absolute top-1/2 left-1/4 transform -translate-x-1/2 -translate-y-1/2">
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center animate-float">
                    <i class="fas fa-motorcycle text-white text-xl"></i>
                </div>
            </div>

            <!-- Destination marker -->
            <div class="absolute top-1/2 right-1/4 transform -translate-x-1/2 -translate-y-1/2">
                <div class="w-12 h-12 rounded-full bg-white border-4 border-primary flex items-center justify-center">
                    <i class="fas fa-home text-primary text-xl"></i>
                </div>
            </div>
        </div>

        <div class="mt-4 text-center text-sm text-gray-600">
            <i class="fas fa-info-circle mr-2"></i>
            Your driver is about 3.5 km away
        </div>
    </div>

    <!-- Help Section -->
    <div class="modern-card p-6">
        <h3 class="text-lg font-display font-bold mb-4">Need Help?</h3>
        <div class="grid md:grid-cols-3 gap-4">
            <button onclick="contactSupport()" class="modern-btn-outline p-4 text-left">
                <i class="fas fa-headset text-xl mb-3"></i>
                <div class="font-bold">Contact Support</div>
                <div class="text-sm text-gray-600">24/7 customer service</div>
            </button>
            <button onclick="modifyOrder()" class="modern-btn-outline p-4 text-left">
                <i class="fas fa-edit text-xl mb-3"></i>
                <div class="font-bold">Modify Order</div>
                <div class="text-sm text-gray-600">Change delivery time or address</div>
            </button>
            <button onclick="cancelOrder()" class="modern-btn-outline p-4 text-left border-danger/50 text-danger hover:bg-danger/10">
                <i class="fas fa-times-circle text-xl mb-3"></i>
                <div class="font-bold">Cancel Order</div>
                <div class="text-sm text-gray-600">Cancel your order</div>
            </button>
        </div>
    </div>
</div>

<!-- Embedded JavaScript -->
<script>
    // Order tracking data
    const orderData = {
        id: 'ORD-' + Date.now().toString().slice(-8),
        status: 'preparing',
        items: [
            { name: 'Classic Burger', quantity: 2, price: 8.99 },
            { name: 'French Fries', quantity: 1, price: 3.99 },
            { name: 'Coca-Cola', quantity: 1, price: 2.50 }
        ],
        restaurant: 'Burger Palace',
        driver: 'Alex Papadopoulos',
        driverPhone: '+30 697 123 4567',
        restaurantPhone: '+30 210 987 6543',
        address: 'Patission 76, Athens 10434',
        placedTime: new Date(Date.now() - 5 * 60000), // 5 minutes ago
        estimatedDelivery: new Date(Date.now() + 25 * 60000), // 25 minutes from now
        subtotal: 23.97,
        total: 26.97
    };

    // Initialize tracking
    function initTracking() {
        // Set order ID
        document.getElementById('order-id').textContent = orderData.id;

        // Render order items
        renderOrderItems();

        // Update times
        updateTimes();

        // Start countdown
        startCountdown();

        // Setup event listeners
        setupTrackingEvents();

        // Start simulated updates
        startSimulatedUpdates();
    }

    function renderOrderItems() {
        const container = document.getElementById('tracking-items');
        const subtotalEl = document.getElementById('tracking-subtotal');
        const totalEl = document.getElementById('tracking-total');

        container.innerHTML = orderData.items.map(item => `
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center">
                        <i class="fas fa-utensils text-gray-400"></i>
                    </div>
                    <div>
                        <div class="font-medium">${item.name}</div>
                        <div class="text-sm text-gray-500">Quantity: ${item.quantity}</div>
                    </div>
                </div>
                <div class="font-medium">€${(item.price * item.quantity).toFixed(2)}</div>
            </div>
        `).join('');

        subtotalEl.textContent = `€${orderData.subtotal.toFixed(2)}`;
        totalEl.textContent = `€${orderData.total.toFixed(2)}`;
    }

    function updateTimes() {
        const timeFormat = { hour: '2-digit', minute: '2-digit' };

        document.getElementById('time-placed').textContent =
            orderData.placedTime.toLocaleTimeString([], timeFormat);

        document.getElementById('time-preparing').textContent =
            orderData.placedTime.toLocaleTimeString([], timeFormat);

        document.getElementById('time-ontheway').textContent =
            'Estimated ' + new Date(Date.now() + 20 * 60000).toLocaleTimeString([], timeFormat);

        document.getElementById('time-delivered').textContent =
            'Estimated ' + orderData.estimatedDelivery.toLocaleTimeString([], timeFormat);

        document.getElementById('driver-name').textContent = orderData.driver;
    }

    function startCountdown() {
        const countdownEl = document.getElementById('countdown');
        const targetTime = orderData.estimatedDelivery.getTime();

        function updateCountdown() {
            const now = Date.now();
            const diff = targetTime - now;

            if (diff <= 0) {
                countdownEl.textContent = '00:00';
                updateOrderStatus('delivered');
                return;
            }

            const minutes = Math.floor(diff / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);

            countdownEl.textContent =
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        updateCountdown();
        setInterval(updateCountdown, 1000);
    }

    function updateOrderStatus(newStatus) {
        orderData.status = newStatus;

        // Update progress steps
        document.querySelectorAll('.progress-step').forEach(step => {
            step.classList.remove('active', 'completed');
        });

        const steps = document.querySelectorAll('.progress-step');
        steps.forEach((step, index) => {
            if (index < 4) { // All steps up to current
                step.classList.add('completed');
            }
        });

        // Set current step as active
        const statusIndex = { 'placed': 0, 'preparing': 1, 'ontheway': 2, 'delivered': 3 }[newStatus];
        if (statusIndex !== undefined) {
            steps[statusIndex].classList.add('active');
        }

        // Show notification
        const statusMessages = {
            'preparing': 'Your order is being prepared',
            'ontheway': 'Your order is on the way!',
            'delivered': 'Your order has been delivered!'
        };

        if (statusMessages[newStatus]) {
            showToast('Status Update', statusMessages[newStatus], 'info');
        }
    }

    function startSimulatedUpdates() {
        // Simulate status updates
        setTimeout(() => {
            updateOrderStatus('ontheway');
        }, 15000); // After 15 seconds

        setTimeout(() => {
            updateOrderStatus('delivered');
        }, 45000); // After 45 seconds
    }

    function setupTrackingEvents() {
        // Setup driver animation
        const driverMarker = document.querySelector('.fa-motorcycle').parentElement;
        let position = 25;

        setInterval(() => {
            if (position < 75 && orderData.status === 'ontheway') {
                position += 0.5;
                driverMarker.style.left = `${position}%`;
            }
        }, 1000);
    }

    // Action functions
    function callRestaurant() {
        showToast('Calling restaurant', `Dialing ${orderData.restaurantPhone}`, 'info');
        // In a real app: window.location.href = `tel:${orderData.restaurantPhone}`;
    }

    function callDriver() {
        showToast('Calling driver', `Dialing ${orderData.driverPhone}`, 'info');
        // In a real app: window.location.href = `tel:${orderData.driverPhone}`;
    }

    function contactSupport() {
        showToast('Contact Support', 'Connecting you to customer service...', 'info');
    }

    function modifyOrder() {
        showToast('Modify Order', 'This feature is coming soon!', 'info');
    }

    function cancelOrder() {
        if (confirm('Are you sure you want to cancel this order?')) {
            showToast('Order Cancelled', 'Your order has been cancelled. Refund will be processed within 5-7 days.', 'warning');
            setTimeout(() => {
                window.location.href = '/orders';
            }, 3000);
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        initTracking();
    });
</script>

<style>
    .animate-float {
        animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
        0%, 100% { transform: translate(-50%, -50%) translateY(0px); }
        50% { transform: translate(-50%, -50%) translateY(-10px); }
    }

    /* Status dot animations */
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    .animate-pulse {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
</style>
</html>