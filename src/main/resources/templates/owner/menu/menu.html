<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">
<head>
    <title>Menu Management</title>
</head>
<body>
<div layout:fragment="main">
    <!-- Menu Header -->
    <div class="glass-panel p-8 mb-8">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-orbitron font-bold text-white mb-2">
                    Menu - <span th:text="${store.name}">Store</span>
                </h1>
                <p class="text-gray-400">Manage your menu items</p>
            </div>
            <div class="flex gap-3">
                <a th:href="@{/owner/stores/{id}/menu/new(id=${store.id})}" class="cyber-button">
                    <i class="fas fa-plus mr-2"></i>Add Menu Item
                </a>
                <a th:href="@{/owner/dashboard}" class="cyber-button inline-block opacity-60 hover:opacity-80">
                    <i class="fas fa-arrow-left mr-2"></i>Back
                </a>
            </div>
        </div>
    </div>

    <!-- Menu Items -->
    <div th:if="${menuItems.isEmpty()}" class="glass-panel p-12 text-center">
        <i class="fas fa-utensils text-4xl text-gray-500 mb-4"></i>
        <h3 class="text-xl font-bold text-white mb-2">No menu items yet</h3>
        <p class="text-gray-400 mb-6">Start by adding your first menu item</p>
        <a th:href="@{/owner/stores/{id}/menu/new(id=${store.id})}" class="cyber-button inline-block">
            <i class="fas fa-plus mr-2"></i>Add First Item
        </a>
    </div>

    <div th:if="${!menuItems.isEmpty()}" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <div th:each="item : ${menuItems}" class="glass-panel p-6 relative group hover:border-cyber-blue/50 transition-all duration-300">
            <!-- Clickable Area for Details -->
            <div class="cursor-pointer"
                 th:onclick="openItemModal([[${item.id}]], [[${item.name}]], [[${item.description}]], [[${item.price}]], [[${item.imageUrl}]], [[${item.available}]])">
                <div class="mb-4 overflow-hidden rounded-lg">
                    <img th:if="${item.imageUrl != null && !item.imageUrl.isEmpty()}"
                         th:src="${item.imageUrl}"
                         th:alt="${item.name}"
                         class="w-full h-48 object-cover transform group-hover:scale-110 transition-transform duration-500" />
                    <div th:if="${item.imageUrl == null || item.imageUrl.isEmpty()}"
                         class="w-full h-48 bg-white/5 flex items-center justify-center text-gray-500">
                        <i class="fas fa-image text-3xl"></i>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="flex justify-between items-start">
                        <h3 class="text-xl font-bold text-white mb-1 group-hover:text-cyber-blue transition-colors" th:text="${item.name}">Item</h3>
                        <span class="text-xl font-bold text-cyber-blue">
                            €<span th:text="${#numbers.formatDecimal(item.price, 1, 2)}">0.00</span>
                        </span>
                    </div>
                    <p class="text-gray-400 text-sm line-clamp-2" th:text="${item.description}">Description</p>
                </div>

                <div class="flex flex-wrap gap-2 mb-4">
                    <span class="text-xs px-2 py-1 rounded-full bg-purple-500/20 text-purple-300 border border-purple-500/30"
                          th:text="${item.category != null ? #strings.capitalize(#strings.toLowerCase(#strings.replace(item.category.name(), '_', ' '))) : 'Uncategorized'}">Category</span>
                    <span class="text-xs px-2 py-1 rounded-full border"
                          th:classappend="${item.available} ? 'bg-green-500/20 text-green-300 border-green-500/30' : 'bg-red-500/20 text-red-300 border-red-500/30'">
                        <span th:text="${item.available} ? 'Available' : 'Unavailable'">Available</span>
                    </span>
                </div>
            </div>

            <!-- Quick Actions (Hover visible or always visible depending on preference, sticking to always visible for usability) -->
            <div class="grid grid-cols-2 gap-2 mt-4 pt-4 border-t border-white/10">
                <a th:href="@{/owner/menu-items/{id}/edit(id=${item.id})}" class="cyber-button text-xs py-2 text-center">
                    <i class="fas fa-edit mr-1"></i>Edit
                </a>
                <form th:action="@{/owner/menu-items/{id}/delete(id=${item.id})}" method="post" onsubmit="return confirm('Are you sure you want to delete this item?');">
                    <button type="submit" class="w-full py-2 bg-red-500/20 hover:bg-red-500/30 text-red-300 rounded-lg text-xs font-bold uppercase transition-colors border border-red-500/30">
                        <i class="fas fa-trash mr-1"></i>Delete
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Item Details Modal -->
    <div id="itemModal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="fixed inset-0 bg-black/80 backdrop-blur-sm transition-opacity" onclick="closeItemModal()"></div>
        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-lg bg-[#0f172a] border border-white/10 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg glass-panel">

                    <!-- Modal Header -->
                    <div class="relative">
                        <img id="modalImage" src="" alt="" class="w-full h-56 object-cover hidden">
                        <div id="modalImagePlaceholder" class="w-full h-56 bg-white/5 flex items-center justify-center hidden">
                            <i class="fas fa-image text-4xl text-gray-600"></i>
                        </div>
                        <button onclick="closeItemModal()" class="absolute top-4 right-4 text-white bg-black/50 hover:bg-black/70 rounded-full w-8 h-8 flex items-center justify-center transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-gray-900 to-transparent p-4">
                            <h3 class="text-2xl font-bold text-white mb-1" id="modalTitle">Item Name</h3>
                            <span class="text-xl font-bold text-cyber-blue" id="modalPrice">€0.00</span>
                        </div>
                    </div>

                    <div class="p-6">
                        <p class="text-gray-300 mb-6" id="modalDescription">Description goes here...</p>

                        <div class="flex items-center justify-between mb-6 p-3 bg-white/5 rounded-lg">
                            <span class="text-sm text-gray-400">Status</span>
                            <span id="modalStatus" class="px-2 py-1 rounded-full text-xs font-bold">Available</span>
                        </div>

                        <!-- Modal Actions -->
                        <div class="grid grid-cols-2 gap-3">
                            <a id="modalEditBtn" href="#" class="cyber-button text-center">
                                <i class="fas fa-edit mr-2"></i>Edit
                            </a>
                            <a id="modalOptionsBtn" href="#" class="cyber-button text-center bg-purple-500/20 hover:bg-purple-500/30 border-purple-500/50">
                                <i class="fas fa-sliders mr-2"></i>Options
                            </a>
                            <a id="modalIngredientsBtn" href="#" class="cyber-button text-center bg-green-500/20 hover:bg-green-500/30 border-green-500/50">
                                <i class="fas fa-leaf mr-2"></i>Ingredients
                            </a>
                            <form id="modalDeleteForm" method="post" onsubmit="return confirm('Delete this menu item?');">
                                <button type="submit" class="w-full h-full bg-red-500/20 hover:bg-red-500/30 text-red-300 rounded-lg font-bold border border-red-500/30 transition-colors">
                                    <i class="fas fa-trash mr-2"></i>Delete
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        function openItemModal(id, name, description, price, imageUrl, available) {
            document.getElementById('modalTitle').textContent = name;
            document.getElementById('modalDescription').textContent = description || 'No description available.';
            document.getElementById('modalPrice').textContent = '€' + parseFloat(price).toFixed(2);

            const img = document.getElementById('modalImage');
            const placeholder = document.getElementById('modalImagePlaceholder');
            if (imageUrl) {
                img.src = imageUrl;
                img.classList.remove('hidden');
                placeholder.classList.add('hidden');
            } else {
                img.classList.add('hidden');
                placeholder.classList.remove('hidden');
            }

            const status = document.getElementById('modalStatus');
            if (available) {
                status.textContent = 'Available';
                status.className = 'px-2 py-1 rounded-full text-xs font-bold bg-green-500/20 text-green-300';
            } else {
                status.textContent = 'Unavailable';
                status.className = 'px-2 py-1 rounded-full text-xs font-bold bg-red-500/20 text-red-300';
            }

            // Set Links
            document.getElementById('modalEditBtn').href = '/owner/menu-items/' + id + '/edit';
            document.getElementById('modalOptionsBtn').href = '/owner/menu-items/' + id + '/options';
            document.getElementById('modalIngredientsBtn').href = '/owner/menu-items/' + id + '/ingredients';
            document.getElementById('modalDeleteForm').action = '/owner/menu-items/' + id + '/delete';

            document.getElementById('itemModal').classList.remove('hidden');
        }

        function closeItemModal() {
            document.getElementById('itemModal').classList.add('hidden');
        }
    </script>
</div>
</body>
</html>
