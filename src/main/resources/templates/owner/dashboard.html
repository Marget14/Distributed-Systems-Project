<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">
<head>
    <title>Owner Dashboard - StreetFoodGo</title>
</head>
<body>
<div layout:fragment="main">
    <!-- Header -->
    <div class="glass-panel p-8 mb-8">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-orbitron font-bold text-white mb-2">Owner Dashboard</h1>
                <p class="text-gray-400">Manage your store and monitor performance</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right">
                    <p class="text-sm text-gray-400">Your Store</p>
                    <p class="text-xl font-bold text-white" th:text="${store?.name}">QuantumBurger</p>
                </div>
                <div class="w-12 h-12 rounded-full bg-gradient-to-br from-cyber-blue to-quantum flex items-center justify-center">
                    <i class="fas fa-store text-white"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="glass-panel p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-400 text-sm mb-1">Today's Orders</p>
                    <p class="text-3xl font-bold text-white" th:text="${stats?.todayOrders ?: 0}">24</p>
                </div>
                <div class="w-12 h-12 rounded-full bg-green-500/20 flex items-center justify-center">
                    <i class="fas fa-shopping-cart text-green-400 text-xl"></i>
                </div>
            </div>
            <div class="mt-4">
                <div class="flex items-center text-sm">
                    <span class="text-green-400 mr-2">↑ 12%</span>
                    <span class="text-gray-400">from yesterday</span>
                </div>
            </div>
        </div>

        <div class="glass-panel p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-400 text-sm mb-1">Total Revenue</p>
                    <p class="text-3xl font-bold text-white">€<span th:text="${stats?.totalRevenue ?: 0}">542.80</span></p>
                </div>
                <div class="w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center">
                    <i class="fas fa-euro-sign text-blue-400 text-xl"></i>
                </div>
            </div>
            <div class="mt-4">
                <div class="flex items-center text-sm">
                    <span class="text-green-400 mr-2">↑ 8%</span>
                    <span class="text-gray-400">from last week</span>
                </div>
            </div>
        </div>

        <div class="glass-panel p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-400 text-sm mb-1">Active Orders</p>
                    <p class="text-3xl font-bold text-white" th:text="${stats?.activeOrders ?: 0}">8</p>
                </div>
                <div class="w-12 h-12 rounded-full bg-yellow-500/20 flex items-center justify-center">
                    <i class="fas fa-clock text-yellow-400 text-xl"></i>
                </div>
            </div>
            <div class="mt-4">
                <div class="flex items-center text-sm">
                    <span class="text-red-400 mr-2">↑ 3 waiting</span>
                    <span class="text-gray-400">to be processed</span>
                </div>
            </div>
        </div>

        <div class="glass-panel p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-400 text-sm mb-1">Avg. Rating</p>
                    <p class="text-3xl font-bold text-white" th:text="${stats?.averageRating ?: 0}">4.7</p>
                </div>
                <div class="w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center">
                    <i class="fas fa-star text-purple-400 text-xl"></i>
                </div>
            </div>
            <div class="mt-4">
                <div class="flex items-center text-sm">
                    <span class="text-green-400 mr-2">128 reviews</span>
                    <span class="text-gray-400">this month</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column -->
        <div class="lg:col-span-2 space-y-8">
            <!-- Recent Orders -->
            <div class="glass-panel p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-orbitron font-bold text-white">Recent Orders</h2>
                    <a th:href="@{/owner/orders}" class="text-cyber-blue hover:text-cyber-blue/80 text-sm">
                        View All <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full cyber-table">
                        <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Time</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="order : ${recentOrders}">
                            <td class="font-mono">#<span th:text="${order.id}">00042</span></td>
                            <td>
                                <div class="font-medium text-white" th:text="${order.customerName}">John Doe</div>
                                <div class="text-xs text-gray-400" th:text="${order.itemsCount} + ' items'">3 items</div>
                            </td>
                            <td class="text-white font-semibold">€<span th:text="${order.totalAmount}">24.50</span></td>
                            <td>
                                    <span th:class="${'status-badge ' + order.status.toLowerCase()}"
                                          th:text="${order.status}">
                                        PREPARING
                                    </span>
                            </td>
                            <td class="text-gray-400 text-sm" th:text="${#temporals.format(order.createdAt, 'HH:mm')}">14:30</td>
                            <td>
                                <div class="flex gap-2">
                                    <button th:if="${order.status == 'PENDING'}"
                                            class="px-3 py-1 bg-green-500/20 text-green-400 rounded text-sm hover:bg-green-500/30"
                                            th:onclick="'acceptOrder(' + ${order.id} + ')'">
                                        Accept
                                    </button>
                                    <button th:if="${order.status == 'PENDING'}"
                                            class="px-3 py-1 bg-red-500/20 text-red-400 rounded text-sm hover:bg-red-500/30"
                                            th:onclick="'rejectOrder(' + ${order.id} + ')'">
                                        Reject
                                    </button>
                                    <a th:href="@{/owner/orders/{id}(id=${order.id})}"
                                       class="px-3 py-1 bg-cyber-blue/20 text-cyber-blue rounded text-sm hover:bg-cyber-blue/30">
                                        View
                                    </a>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Revenue Chart -->
            <div class="glass-panel p-6">
                <h2 class="text-2xl font-orbitron font-bold text-white mb-6">Revenue Overview</h2>
                <div class="h-64">
                    <!-- Chart would go here -->
                    <div class="w-full h-full flex items-center justify-center">
                        <div class="text-center">
                            <i class="fas fa-chart-line text-4xl text-gray-600 mb-4"></i>
                            <p class="text-gray-400">Revenue chart will be displayed here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="space-y-8">
            <!-- Quick Actions -->
            <div class="glass-panel p-6">
                <h2 class="text-2xl font-orbitron font-bold text-white mb-6">Quick Actions</h2>
                <div class="space-y-3">
                    <a th:href="@{/owner/menu}" class="flex items-center p-4 rounded-lg hover:bg-white/5 transition-all group">
                        <div class="w-12 h-12 rounded-lg bg-cyber-blue/20 flex items-center justify-center mr-4 group-hover:bg-cyber-blue/30">
                            <i class="fas fa-utensils text-cyber-blue"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold text-white">Manage Menu</h3>
                            <p class="text-sm text-gray-400">Add, edit or remove items</p>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500"></i>
                    </a>

                    <a th:href="@{/owner/store/edit}" class="flex items-center p-4 rounded-lg hover:bg-white/5 transition-all group">
                        <div class="w-12 h-12 rounded-lg bg-neon-pink/20 flex items-center justify-center mr-4 group-hover:bg-neon-pink/30">
                            <i class="fas fa-store text-neon-pink"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold text-white">Store Settings</h3>
                            <p class="text-sm text-gray-400">Update store information</p>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500"></i>
                    </a>

                    <a th:href="@{/owner/hours}" class="flex items-center p-4 rounded-lg hover:bg-white/5 transition-all group">
                        <div class="w-12 h-12 rounded-lg bg-ai-orange/20 flex items-center justify-center mr-4 group-hover:bg-ai-orange/30">
                            <i class="fas fa-clock text-ai-orange"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold text-white">Opening Hours</h3>
                            <p class="text-sm text-gray-400">Set business hours</p>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500"></i>
                    </a>

                    <a th:href="@{/owner/analytics}" class="flex items-center p-4 rounded-lg hover:bg-white/5 transition-all group">
                        <div class="w-12 h-12 rounded-lg bg-quantum/20 flex items-center justify-center mr-4 group-hover:bg-quantum/30">
                            <i class="fas fa-chart-bar text-quantum"></i>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-semibold text-white">View Analytics</h3>
                            <p class="text-sm text-gray-400">Detailed performance reports</p>
                        </div>
                        <i class="fas fa-chevron-right text-gray-500"></i>
                    </a>
                </div>
            </div>

            <!-- Store Status -->
            <div class="glass-panel p-6">
                <h2 class="text-2xl font-orbitron font-bold text-white mb-6">Store Status</h2>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400">Current Status</p>
                            <div class="flex items-center mt-1">
                                <div th:class="${store?.open ? 'bg-green-400' : 'bg-red-400'} w-3 h-3 rounded-full mr-2"></div>
                                <span class="text-white font-semibold" th:text="${store?.open ? 'OPEN' : 'CLOSED'}">OPEN</span>
                            </div>
                        </div>
                        <button th:onclick="${store?.open ? 'closeStore()' : 'openStore()'}"
                                th:class="${store?.open ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30' : 'bg-green-500/20 text-green-400 hover:bg-green-500/30'}"
                                class="px-4 py-2 rounded-lg transition-colors">
                            <span th:text="${store?.open ? 'Close Store' : 'Open Store'}">Close Store</span>
                        </button>
                    </div>

                    <div class="pt-4 border-t border-white/10">
                        <p class="text-gray-400 mb-2">Next Auto-Close</p>
                        <p class="text-white">22:00 (in 3h 15m)</p>
                    </div>

                    <div class="pt-4 border-t border-white/10">
                        <p class="text-gray-400 mb-2">Orders Today</p>
                        <div class="flex items-center">
                            <div class="flex-1 bg-white/10 rounded-full h-2">
                                <div class="bg-cyber-blue h-2 rounded-full" style="width: 75%"></div>
                            </div>
                            <span class="ml-3 text-white font-semibold">24/32</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for Owner Dashboard -->
<script>
    function acceptOrder(orderId) {
        if (confirm('Accept this order?')) {
            fetch(`/api/owner/orders/${orderId}/accept`, {
                method: 'POST',
                headers: {
                    'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]').getAttribute('content')
                }
            })
                .then(response => {
                    if (response.ok) {
                        location.reload();
                    }
                });
        }
    }

    function rejectOrder(orderId) {
        const reason = prompt('Reason for rejection:');
        if (reason) {
            fetch(`/api/owner/orders/${orderId}/reject`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]').getAttribute('content')
                },
                body: JSON.stringify({ reason: reason })
            })
                .then(response => {
                    if (response.ok) {
                        location.reload();
                    }
                });
        }
    }

    function openStore() {
        fetch('/api/owner/store/open', {
            method: 'POST',
            headers: {
                'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]').getAttribute('content')
            }
        })
            .then(response => {
                if (response.ok) {
                    location.reload();
                }
            });
    }

    function closeStore() {
        fetch('/api/owner/store/close', {
            method: 'POST',
            headers: {
                'X-CSRF-TOKEN': document.querySelector('meta[name="_csrf"]').getAttribute('content')
            }
        })
            .then(response => {
                if (response.ok) {
                    location.reload();
                }
            });
    }
</script>

<style>
    .status-badge {
        @apply px-3 py-1 rounded-full text-xs font-semibold;
    }
    .status-badge.pending {
        @apply bg-yellow-500/20 text-yellow-400;
    }
    .status-badge.accepted {
        @apply bg-blue-500/20 text-blue-400;
    }
    .status-badge.preparing {
        @apply bg-purple-500/20 text-purple-400;
    }
    .status-badge.ready {
        @apply bg-green-500/20 text-green-400;
    }
    .status-badge.delivering {
        @apply bg-cyber-blue/20 text-cyber-blue;
    }
    .status-badge.completed {
        @apply bg-gray-500/20 text-gray-400;
    }
    .status-badge.cancelled {
        @apply bg-red-500/20 text-red-400;
    }
</style>
</body>
</html>