<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{base}">
<head>
    <title>Owner Dashboard - StreetFoodGo</title>
</head>
<body>
<div layout:fragment="main">

    <div class="glass-panel p-8 mb-8">
        <div class="flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-orbitron font-bold text-white mb-2">
                    <i class="fas fa-tachometer-alt mr-2"></i>Owner Dashboard
                </h1>
                <p class="text-gray-400">Manage your stores, menus, and incoming orders</p>
            </div>
            <div class="text-right">
                <p class="text-sm text-gray-400">Role</p>
                <p class="text-lg font-semibold text-white">
                    <i class="fas fa-crown text-neon-pink mr-1"></i>OWNER
                </p>
            </div>
        </div>
    </div>

    <!-- Quick Stats (if store exists) -->
    <div th:if="${stores != null && !stores.isEmpty()}" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="glass-panel p-6 text-center">
            <i class="fas fa-store text-3xl text-neon-pink mb-2"></i>
            <p class="text-gray-400 text-sm mb-1">My Stores</p>
            <p class="text-3xl font-bold text-white" th:text="${stores.size()}">0</p>
        </div>
        <div class="glass-panel p-6 text-center">
            <i class="fas fa-clock-rotate-left text-3xl text-yellow-400 mb-2"></i>
            <p class="text-gray-400 text-sm mb-1">Pending Orders</p>
            <p class="text-3xl font-bold text-yellow-400" id="pendingCount">-</p>
        </div>
        <div class="glass-panel p-6 text-center">
            <i class="fas fa-utensils text-3xl text-purple-400 mb-2"></i>
            <p class="text-gray-400 text-sm mb-1">Preparing</p>
            <p class="text-3xl font-bold text-purple-400" id="preparingCount">-</p>
        </div>
        <div class="glass-panel p-6 text-center">
            <i class="fas fa-check-circle text-3xl text-green-400 mb-2"></i>
            <p class="text-gray-400 text-sm mb-1">Today's Orders</p>
            <p class="text-3xl font-bold text-green-400" id="todayCount">-</p>
        </div>
    </div>

    <div th:if="${stores == null || stores.isEmpty()}" class="glass-panel p-10 text-center">
        <i class="fas fa-store text-4xl text-gray-500 mb-4"></i>
        <h2 class="text-xl font-bold text-white mb-2">No stores assigned</h2>
        <p class="text-gray-400">Please contact an admin to assign a store to your account.</p>
    </div>

    <div th:if="${stores != null && !stores.isEmpty()}" class="space-y-6">
        <div class="glass-panel p-6" th:each="store : ${stores}">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <div>
                    <h2 class="text-2xl font-bold text-white" th:text="${store.name}">Store Name</h2>
                    <p class="text-gray-400 text-sm" th:text="${store.address}">Address</p>
                    <div class="mt-3 flex flex-wrap gap-2">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold"
                              th:classappend="${store.isOpen} ? 'bg-green-500/20 text-green-300' : 'bg-red-500/20 text-red-300'">
                            <i th:class="${store.isOpen} ? 'fas fa-door-open mr-1' : 'fas fa-door-closed mr-1'"></i>
                            <span th:text="${store.isOpen} ? 'OPEN' : 'CLOSED'">OPEN</span>
                        </span>
                        <span class="px-3 py-1 rounded-full bg-cyber-blue/20 text-cyber-blue text-xs font-semibold">
                            <i class="fas fa-map-marker-alt mr-1"></i>
                            <span th:text="${store.area != null ? store.area : 'N/A'}">Area</span>
                        </span>
                    </div>
                </div>

                <div class="flex flex-wrap gap-3">
                    <a th:href="@{/owner/stores/{id}/menu(id=${store.id})}" class="cyber-button">
                        <i class="fas fa-utensils mr-2"></i>Manage Menu
                    </a>
                    <a th:href="@{/owner/stores/{id}/orders(id=${store.id})}" class="cyber-button inline-block opacity-60 hover:opacity-80">
                        <i class="fas fa-clipboard-list mr-2"></i>View Orders
                    </a>
                    <a th:href="@{/owner/stores/{id}/edit(id=${store.id})}" class="cyber-button inline-block opacity-60 hover:opacity-80">
                        <i class="fas fa-gear mr-2"></i>Store Settings
                    </a>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Auto-refresh for order stats -->
<script th:inline="javascript">
    const stores = /*[[${stores}]]*/ [];

    // Load order stats on page load
    document.addEventListener('DOMContentLoaded', function() {
        if (stores && stores.length > 0) {
            updateStats();
            // Refresh every 15 seconds
            setInterval(updateStats, 15000);
        }
    });

    async function updateStats() {
        try {
            // For simplicity, we'll fetch for first store
            // In production, aggregate all stores
            const storeId = stores[0].id;

            // Simulated stats (replace with actual API call)
            // const response = await fetch(`/api/owner/stores/${storeId}/stats`);
            // const data = await response.json();

            // For now, show placeholder values
            // You can implement actual endpoint later
            document.getElementById('pendingCount').textContent = '-';
            document.getElementById('preparingCount').textContent = '-';
            document.getElementById('todayCount').textContent = '-';

            console.log('ðŸ“Š Dashboard stats updated');
        } catch (error) {
            console.error('Failed to update stats:', error);
        }
    }
</script>
</body>
</html>
